{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { trigger, style, transition, animate } from '@angular/animations/animations';\nimport { ContextModalComponent } from 'src/app/context-modal/context-modal.component';\nimport { ContentModalComponent } from '../content-modal/content-modal.component';\nimport escapeHtml from 'escape-html';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../client.service\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/material/dialog\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../_shared/pipes/safe\";\nconst _c0 = [\"window\"];\n\nfunction WindowComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 3);\n    i0.ɵɵpipe(1, \"safeHtml\");\n  }\n\n  if (rf & 2) {\n    const data_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"innerHTML\", i0.ɵɵpipeBind1(1, 2, data_r2), i0.ɵɵsanitizeHtml)(\"@fadeIn\", undefined);\n  }\n}\n\nexport let WindowComponent = /*#__PURE__*/(() => {\n  class WindowComponent {\n    constructor(clientService, _snackBar, elRef, dialog) {\n      this.clientService = clientService;\n      this._snackBar = _snackBar;\n      this.elRef = elRef;\n      this.dialog = dialog;\n      this.componentActive = true;\n      this.lastKnownScrollPosition = 0;\n      this.unsubscribe$ = new Subject();\n      this.userScrolled = false;\n    }\n\n    ngOnInit() {}\n\n    trackByFn(index, item) {\n      return index;\n    }\n\n    openDialog(x) {\n      this.dialog.open(ContextModalComponent, {\n        data: {\n          name: x.detail.name,\n          desc: x.detail.desc,\n          type: x.detail.type,\n          keyword: x.detail.keyword,\n          canOpen: x.detail.canOpen\n        },\n        width: '500px'\n      });\n    }\n\n    OnClickSendToServer(command) {\n      console.log(command);\n      this.clientService.sendToServer(command.detail);\n    }\n\n    openContentDialog(title, desc) {\n      this.dialog.open(ContentModalComponent, {\n        data: {\n          name: this.clientService.returnContentPopUp().title,\n          desc: this.clientService.returnContentPopUp().description,\n          pageNumber: this.clientService.returnContentPopUp().pageNumber\n        },\n        width: '750px'\n      });\n    }\n\n    ngAfterContentInit() {\n      this.$data = this.clientService.$data.pipe(takeUntil(this.unsubscribe$)).subscribe(x => {\n        if (x.length) {\n          // if user has scrolled above, show notification of new messages\n          // let snackBarRef = this._snackBar.open('new message', 'View', {\n          //     duration: 4000\n          // });\n          console.log(x[x.length - 1]);\n\n          if (x[x.length - 1].startsWith(\"You begin to writing in your book.\")) {\n            this.openContentDialog(\"Write Book\", \"Page\");\n          }\n\n          this.windowData = x;\n        }\n      });\n    }\n    /**\r\n    * Convert color tags into HTML tags.\r\n    * @param {string} text\r\n    * @param {boolean} escape - when `false`, will not escape HTML before parsing. Defaults to `true`.\r\n    * @return {string}\r\n    */\n\n\n    ParseHtmlColorCodes(text, escape = true) {\n      /**\r\n      * The full list of colors.\r\n      */\n      const COLORS = 'white|silver|gray|red|maroon|yellow|olive|lime|green|blue|navy|cyan|teal|purple|magenta|gold|orange|darkorange|orangered|brown|dimgray|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15';\n      /**\r\n       * The template for the resulting replacement.\r\n       * All class names in outputted HTML will be prefixed.\r\n       * You can change the prefix here. If you do, remember to\r\n       * also adjust the CSS file as well.\r\n       */\n\n      const HTML_REPLACEMENT_TEMPLATE = '<span class=\"wm$2\">$3</span>';\n      /**\r\n        * The main Regular Expression for performing replacements.\r\n        */\n\n      const COLOR_RX = new RegExp('({((?:' + COLORS + '))}((?:(?!{(' + COLORS + '|\\/)}).)*)({\\/})*)', 'gims');\n      var escapedText;\n\n      if (escape) {\n        escapedText = escapeHtml(text);\n      } else {\n        escapedText = text;\n      }\n\n      return escapedText.replace(COLOR_RX, HTML_REPLACEMENT_TEMPLATE);\n    }\n\n    ngOnDestroy() {\n      this.unsubscribe$.next();\n      this.unsubscribe$.complete();\n    }\n\n  }\n\n  WindowComponent.ɵfac = function WindowComponent_Factory(t) {\n    return new (t || WindowComponent)(i0.ɵɵdirectiveInject(i1.ClientService), i0.ɵɵdirectiveInject(i2.MatSnackBar), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i3.MatDialog));\n  };\n\n  WindowComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: WindowComponent,\n    selectors: [[\"app-window\"]],\n    viewQuery: function WindowComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.window = _t.first);\n      }\n    },\n    hostBindings: function WindowComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"post-to-server\", function WindowComponent_post_to_server_HostBindingHandler($event) {\n          return ctx.OnClickSendToServer($event);\n        }, false, i0.ɵɵresolveWindow)(\"open-detail\", function WindowComponent_open_detail_HostBindingHandler($event) {\n          return ctx.openDialog($event);\n        }, false, i0.ɵɵresolveWindow);\n      }\n    },\n    decls: 3,\n    vars: 2,\n    consts: [[\"id\", \"clientWindow\", 1, \"window\"], [\"window\", \"\"], [3, \"innerHTML\", 4, \"ngFor\", \"ngForOf\", \"ngForTrackBy\"], [3, \"innerHTML\"]],\n    template: function WindowComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0, 1);\n        i0.ɵɵtemplate(2, WindowComponent_div_2_Template, 2, 4, \"div\", 2);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.windowData)(\"ngForTrackBy\", ctx.trackByFn);\n      }\n    },\n    directives: [i4.NgForOf],\n    pipes: [i5.Safe],\n    styles: [\"::app{background:#111;white-space:pre}table{width:100%}table.data{margin-bottom:15px}table.data tr:nth-child(even){background-color:#555}table.data td{padding-left:5px}pre{display:none}@media (min-width: 600px){pre{display:block}}.echo{color:#666;margin:0}.room-title{color:#2ecc71;border-bottom:1px dashed #555;padding-bottom:5px;margin-top:0;white-space:normal;max-width:720px}.room-description{max-width:720px}.hint,span.wmhint{color:#ff0}.room-exits{color:#2ecc71}.room-dark,.dark-room,.room-dark .room-exits,.dark-room .room-exits{color:#666!important}.mob,.improve{color:#ff0;margin-bottom:0;display:block}.mob{color:#0ff;margin-bottom:10px}.room-emote{margin-bottom:0}.mob-emote{color:#a6a6a6;margin-bottom:10px}.score-table{width:100%;max-width:72ch;border-bottom:1px dashed #555;border-top:1px dashed #555;padding:10px 0;font-size:12px}@media (min-width: 768px){.score-table{font-size:14px}}.group-hp{color:red}.group-mana{color:#0098ff}.group-moves{color:#2ecc71}.damage{color:red}.combat{margin:0}.combat-start{margin-bottom:15px}.cell-title{color:#2ecc71}.ooc{color:#7fff00}.ooc span{color:#fff}.time-of-day{color:#f4d635}.weather{color:#00bfff}.gossip{color:#f0f}.gossip span{color:#fff}.newbie{color:#ff0}.newbie span{color:red}.char-look{border-top:1px solid #cccc;border-bottom:1px solid #cccc;margin:15px 0;max-width:720px}.player{color:#ff8c00;margin-bottom:0}.item{margin-bottom:0}.item:last-of-type{margin-bottom:10px}p{margin-top:0;max-width:720px}.motd,pre{font-size:10px}.help-section{max-width:720px;border-bottom:2px aqua dashed;padding-bottom:10px;margin-bottom:20px}.help-section table{color:#fff;max-width:720px;border-top:2px aqua dashed;border-bottom:2px aqua dashed}.help-section table td{padding:3px 10px;width:inherit}.help-section table td:first-of-type{border-right:1px white dashed;width:118px;color:#0ff;padding-left:0}.help-section .simple{border-collapse:collapse;border-top:0 none;border-bottom:0 none}.help-section .simple tr:nth-child(even){background-color:#242528}.help-section .simple td:first-of-type{border-right:0 none;width:auto;color:#ff0;padding-left:0}.help-section .simple.heading td:first-of-type{color:#fff}.help-section .simple.heading tr:nth-child(odd) td{color:#ff0;font-weight:700;margin:10px 0}.help-section pre{color:#fff;font-size:15px;font-family:Verdana,Geneva,Tahoma,sans-serif;white-space:break-spaces}.help-list td:first-of-type{color:#0ff;width:118px}table.simple{width:730px;border-collapse:collapse;border-top:0 none;border-bottom:0 none}table.simple tr:nth-child(even){background-color:#242528}table.simple td:first-of-type{border-right:0 none;width:auto;color:#ff0;padding-left:0;min-width:150px}.verbose-exit-wrapper .verbose-exit{color:#fff;white-space:nowrap;width:1%}.room-dark .verbose-exit,.room-dark .verbose-exit-wrapper .verbose-exit,.room-dark .verbose-exit-name a,.room-dark .verbose-exit-wrapper,.room-dark table td{color:#666!important}.verbose-exit-name a{color:#2ecc71}.verbose-exit-name a:hover{border-bottom-color:#2ecc71}@-webkit-keyframes fadein{0%{opacity:0}to{opacity:1}}@keyframes fadein{0%{opacity:0}to{opacity:1}}@-webkit-keyframes fadeout{0%{opacity:1}to{opacity:0}}@keyframes fadeout{0%{opacity:1}to{opacity:0}}span.wm1,span.wmmaroon{color:maroon}span.wm2,span.wmgreen{color:green}span.wm3,span.wmolive{color:olive}span.wm4,span.wmnavy{color:navy}span.wm5,span.wmpurple{color:purple}span.wm6,span.wmteal{color:teal}span.wm7,span.wmgray{color:gray}span.wm8,span.wmsilver{color:silver}span.wm9,span.wmred{color:red}span.wm10,span.wmlime{color:#0f0}span.wm11,span.wmyellow{color:#ff0}span.wm12,span.wmblue{color:#00f}span.wm13,span.wmmagenta{color:#f0f}span.wm14,span.wmcyan{color:#0ff}span.wm15,span.wmwhite{color:#fff}span.wmgold{color:gold}span.wmorange{color:orange}span.wmdarkorange{color:#ff8c00}span.wmorangered{color:#ff4500}span.wmbrown{color:brown}span.wmdimgray{color:#696969}\\n\"],\n    encapsulation: 2,\n    data: {\n      animation: [trigger('fadeIn', [transition(':enter', [style({\n        opacity: '0'\n      }), animate('.4s ease-out', style({\n        opacity: '1'\n      }))])])]\n    }\n  });\n  return WindowComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}